{"version":3,"sources":["card-manager.js"],"names":["$","appendMessage","msg","error","$div","addClass","find","text","before","setTimeout","remove","document","on","e","preventDefault","$container","this","parents","$row","seqNo","attr","window","confirm","WooPayJpCC","block","message","overlayCSS","background","ajaxLoaderImage","opacity","get","endpoint","action","action_delete","_wpnonce","nonce","card_id","done","response","success","alert","fail","failureDelete","always","unblock","submit","$form","post","action_add","payjp_token","val","result","append","html","removeClass","failureAdd","$block","button_text","errorHandler","status","jQuery","wooPayJpCardSubmit","wooPayJpCardFailed"],"mappings":"CAOA,SAAWA,GACT,YA0CA,SAASC,GAAcC,EAAKC,GAC1B,GAAIC,GAAOJ,EAAE,iEACTG,IACFC,EAAKC,SAAS,uBAEhBD,EAAKE,KAAK,KAAKC,KAAKL,GACpBF,EAAE,2BAA2BQ,OAAOJ,GACpCK,WAAW,WACTL,EAAKM,UACJ,KAhDLV,EAAEW,UAAUC,GAAG,QAAS,aAAc,SAAUC,GAC9CA,EAAEC,gBACF,IAAIC,GAAaf,EAAEgB,MAAMC,QAAQ,mBAC7BC,EAAalB,EAAEgB,MAAMC,QAAQ,MAC7BE,EAAanB,EAAEgB,MAAMI,KAAK,eAC1BC,QAAOC,QAAQC,WAAWD,WAC5BP,EAAWS,OACTC,QAAY,KACZC,YACEC,WAAY,YAAcJ,WAAWK,gBAAkB,qBACvDC,QAAY,MAGhB7B,EAAE8B,IAAIP,WAAWQ,UACfC,OAAUT,WAAWU,cACrBC,SAAUX,WAAWY,MACrBC,QAAUjB,IACTkB,KAAK,SAAUC,GACZA,EAASC,SACXrB,EAAKR,SACEK,EAAWT,KAAK,YAAmB,QACxCN,EAAE,0BAA0BK,SAAS,0BAGvCgB,OAAOmB,MAAMF,EAASb,WAEvBgB,KAAK,WACNpB,OAAOmB,MAAMjB,WAAWmB,iBACvBC,OAAO,WACR5B,EAAW6B,eAuBjB5C,EAAEW,UAAUC,GAAG,QAAS,kBAAmB,SAAUC,GACnDA,EAAEC,iBACFd,EAAEgB,MAAMC,QAAQ,iBAAiBP,WAInCa,WAAWsB,OAAS,WAChB,GAAIC,GAAQ9C,EAAE,2BACVe,EAAaf,EAAE,kBACnBe,GAAWS,OACTC,QAAY,KACZC,YACEC,WAAY,YAAcJ,WAAWK,gBAAkB,qBACvDC,QAAY,MAGhB7B,EAAE+C,KAAKxB,WAAWQ,UAChBC,OAAeT,WAAWyB,WAC1Bd,SAAeX,WAAWY,MAC1Bc,YAAejD,EAAE,+CAA+CkD,QAC/Db,KAAK,SAAUc,GACZA,EAAOZ,SACTvC,EAAE,yBAAyBoD,OAAOD,EAAOE,MACzCP,EAAMxC,KAAK,oBAAoB4C,IAAI,IACnClD,EAAE,0BAA0BsD,YAAY,0BAExCrD,EAAckD,EAAO1B,SAAS,KAE/BgB,KAAK,WACNxC,EAAcsB,WAAWgC,YAAY,KACpCZ,OAAO,WACR5B,EAAW6B,SACX,IAAIY,GAASxD,EAAE,sBACfwD,GAAOlD,KAAK,2BAA2B4C,IAAI,IAC3CM,EAAOlD,KAAK,sBAAsBgD,YAAY,aAAaJ,IAAI3B,WAAWkC,gBAIhFlC,WAAWmC,aAAe,SAASC,EAAQxD,GACzCF,EAAcE,GAAO,KAGtByD,QAEHvC,OAAOwC,mBAAqB,SAAUvB,GACpCf,WAAWsB,UAGbxB,OAAOyC,mBAAqB,SAASH,EAAQxD,GAC3CoB,WAAWmC,aAAaC,EAAQxD","file":"../card-manager.js","sourcesContent":["/**\n * Description\n */\n\n/*global WooPayJpCC: false*/\n\n\n(function ($) {\n  'use strict';\n\n  // Enable Credit Card delete.\n  $(document).on('click', '.delete-cc', function (e) {\n    e.preventDefault();\n    var $container = $(this).parents('.my_woopayjp_cc'),\n        $row       = $(this).parents('tr'),\n        seqNo      = $(this).attr('data-card-id');\n    if (window.confirm(WooPayJpCC.confirm)) {\n      $container.block({\n        message   : null,\n        overlayCSS: {\n          background: '#fff url(' + WooPayJpCC.ajaxLoaderImage + ') no-repeat center',\n          opacity   : 0.6\n        }\n      });\n      $.get(WooPayJpCC.endpoint, {\n        action  : WooPayJpCC.action_delete,\n        _wpnonce: WooPayJpCC.nonce,\n        card_id : seqNo\n      }).done(function (response) {\n        if (response.success) {\n          $row.remove();\n          if (!( $container.find('tbody tr').length )) {\n            $('.my_woopayjp_cc__table').addClass('my_woopayjp_cc--empty');\n          }\n        } else {\n          window.alert(response.message);\n        }\n      }).fail(function () {\n        window.alert(WooPayJpCC.failureDelete);\n      }).always(function () {\n        $container.unblock();\n      });\n    }\n  });\n\n  /**\n   * Show error message\n   * @param {String} msg\n   * @param {Boolean} [error]\n   */\n  function appendMessage(msg, error) {\n    var $div = $('<div class=\"woopayjp-msg\"><p></p><a href=\"#\">&times;</a></div>');\n    if (error) {\n      $div.addClass('woopayjp-msg--error');\n    }\n    $div.find('p').text(msg);\n    $('#woopayjp-add-card-form').before($div);\n    setTimeout(function () {\n      $div.remove();\n    }, 10000);\n  }\n\n  // Close btn\n  $(document).on('click', '.woopayjp-msg a', function (e) {\n    e.preventDefault();\n    $(this).parents('.woopayjp-msg').remove();\n  });\n\n  // Register Card\n  WooPayJpCC.submit = function() {\n      var $form = $('#woopayjp-add-card-form');\n      var $container = $('.my_woopayjp_cc');\n      $container.block({\n        message   : null,\n        overlayCSS: {\n          background: '#fff url(' + WooPayJpCC.ajaxLoaderImage + ') no-repeat center',\n          opacity   : 0.6\n        }\n      });\n      $.post(WooPayJpCC.endpoint, {\n        action       : WooPayJpCC.action_add,\n        '_wpnonce'   : WooPayJpCC.nonce,\n        'payjp_token': $('#payjp_checkout_box input[name=payjp-token]').val()\n      }).done(function (result) {\n        if (result.success) {\n          $('.my_woopayjp_cc tbody').append(result.html);\n          $form.find('input[type=text]').val('');\n          $('.my_woopayjp_cc__table').removeClass('my_woopayjp_cc--empty');\n        } else {\n          appendMessage(result.message, true);\n        }\n      }).fail(function () {\n        appendMessage(WooPayJpCC.failureAdd, true);\n      }).always(function () {\n        $container.unblock();\n        var $block = $('#payjp_checkout_box');\n        $block.find('input[name=payjp-token]').val('');\n        $block.find('input[type=button]').removeClass('has-token').val(WooPayJpCC.button_text);\n      });\n  };\n\n  WooPayJpCC.errorHandler = function(status, error) {\n    appendMessage(error, true);\n\n  };\n})(jQuery);\n\nwindow.wooPayJpCardSubmit = function (response) {\n  WooPayJpCC.submit();\n};\n\nwindow.wooPayJpCardFailed = function(status, error) {\n  WooPayJpCC.errorHandler(status, error);\n};\n"]}